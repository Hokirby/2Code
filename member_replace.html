<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>멤버 등록/수정 페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase 구성 정보 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyD8iq6327ovmJVKQflD2E9mzLQElg18kYg",
            authDomain: "teampage-2code.firebaseapp.com",
            projectId: "teampage-2code",
            storageBucket: "teampage-2code.firebasestorage.app",
            messagingSenderId: "495445103559",
            appId: "1:495445103559:web:044d367cdc06ec94b2ffe2",
        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        console.log(window.location.search);
        const uid = window.location.search.substring(5);
        console.log(uid);

        const userRef = doc(db, "memberInfo", uid);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists()) {
            $('#name').val(docSnap.data().name);
            $('#age').val(docSnap.data().age);
            $('#hobby').val(docSnap.data().hobby);
            $('#blog').val(docSnap.data().blog);
            $('#photo').val(docSnap.data().photo);
            $('#resolution').val(docSnap.data().resolution);
        }

        $('#replace').click(async function () {
            let name = $('#name').val();
            let age = $('#age').val();
            let hobby = $('#hobby').val();
            let blog = $('#blog').val();
            let photo = $('#photo').val();
            let resolution = $('#resolution').val();
            let doc = {
                'name': name,
                'age': age,
                'hobby': hobby,
                'blog': blog,
                'photo': photo,
                'resolution': resolution
            }
            try {
                console.log(doc);
                await updateDoc(userRef, doc);
            } catch (error) {
                console.error(error);
                alert ('수정 실패!');
            }
            window.location.href = `member_detail.html?uid=${uid}`;
        })

    </script>
    <style>
        .wrap {
            width: 50%;
            margin: 10% auto 0px auto;
            background-color: #E8344E;
            color: white;
            border-radius: 15px;
        }

        .title {
            padding-top: 20px;
            text-align: center;
        }

        .main_form {
            width: 80%;

            padding-bottom: 20px;
            margin: 30px auto 20px auto;
        }

        .btn_box {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="title">
            <h1>멤버 수정</h1>
        </div>
        <div class="main_form">
            <form id="memberForm">
                <div class="row mb-3">
                    <label for="name" class="col-sm-2 col-form-label">이름</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="name">
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="age" class="col-sm-2 col-form-label">나이</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="age">
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="hobby" class="col-sm-2 col-form-label">취미</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="hobby">
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="blog" class="col-sm-2 col-form-label">블로그</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="blog">
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="photo" class="col-sm-2 col-form-label">사진</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="photo">
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="resolution" class="col-sm-2 col-form-label">나의 다짐</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="resolution">
                    </div>
                </div>
                <div class="btn_box">
                    <button type="button" class="btn btn-outline-light">이전</button>
                    <button type="button" class="btn btn-outline-light" id="replace">수정</button>
                </div>
            </form>
        </div>
    </div>
</body>

</html>