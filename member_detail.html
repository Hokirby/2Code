<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="css\reset.css" />
  <link rel="stylesheet" href="css\styles.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>등록 페이지</title>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs, doc, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    
        // Firebase 구성 정보 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
        apiKey: "AIzaSyD8iq6327ovmJVKQflD2E9mzLQElg18kYg",
        authDomain: "teampage-2code.firebaseapp.com",
        projectId: "teampage-2code",
        storageBucket: "teampage-2code.firebasestorage.app",
        messagingSenderId: "495445103559",
        appId: "1:495445103559:web:044d367cdc06ec94b2ffe2",
        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // uid 추출
        const uid=window.location.search.substring(5);

        // 수정 uid 업데이트
        const link = document.querySelector('.member-detail__red-btn');
        link.href = `./member_modify.html?uid=${uid}`;

        // firebase에서 uid로 정보 조회 후, 가져오기
        async function getUserByUID(uid) {
        const userRef = doc(db, "memberInfo", uid);
        const docSnap = await getDoc(userRef);
        if (docSnap.exists()) {
            
            let name = docSnap.data().name;
            let age = docSnap.data().age;
            let hobby = docSnap.data().hobby;
            let blog = docSnap.data().blog;
            let resolution = docSnap.data().resolution;
            let image = docSnap.data().photo;

            let temp_image_html=`<img class="image" src="${image}">`;
            $('#name').append(name);
            $('#age').append(age);
            $('#hobby').append(hobby);
            $('#blog').append(blog);
            $('#resolution').append(resolution);
            $('#image-box').append(temp_image_html);
        } else {
            console.log("데이터 없음!");
        }
        }

        // 함수실행
        getUserByUID(uid);

        // header, footer 로드
        $(function(){
            $("#member-detail__main-header").load("header.html");
            $("#member-detail__main-footer").load("footer.html");
        });

        // 멤버 삭제
        $("#member-detail__delete").click(async function () {
            if (confirm('정말 삭제하시겠습니까?')){
                
                await deleteDoc(doc(db, "memberInfo", uid));
                alert('삭제 완료!');
                window.location.href="index.html";
            } else {
                alert('취소되었습니다');
                window.location.reload();
            }
        });
    </script>
</head>

<body class="member-detail__body">
    <!-- 메인 헤더 -->
    <div id = "member-detail__main-header"></div>
    <!-- 전체 컨테이너 -->
    <div class="member-detail__container">
        <!-- 메인 컨테이너 -->
        <div class="member-detail__main-container">
            <div class="member-detail__title-box">
                <span class="member-detail__title">상세정보</span>
            </div>
            <!-- 메인 컨텐츠 -->
            <div class="member-detail__detail">
                <div class="member-detail__image-box" id="image-box">
                    
                </div>
                <div class="member-detail__detail-box">
                    <div class="member-detail__detail-box-box">
                        <div class="member-detail__text-box"><span>이름 : <span id="name"></span></div>
                        <div class="member-detail__text-box"><span>나이 : <span id="age"></span></div>
                        <div class="member-detail__text-box"><span>취미 : <span id="hobby"></span></div>
                        <div class="member-detail__text-box"><span>블로그 : <span id="blog"></span></div>
                    </div>
                    <div class="member-detail__resolution-box">
                        <div class="member-detail__text-box">나의 다짐</div>
                        <div class="member-detail__resolution">
                            <span id="resolution"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="member-detail__button-box">
                <a class="member-detail__gray-btn" id="member-detail__cancle" href="index.html">이전</a>
                <a class="member-detail__red-btn" href="./member_replace.html?uid=">수정</a>
                <a class="member-detail__gray-btn" id = "member-detail__delete" href="javascript:;">삭제</a>
            </div>
        </div>
    </div>
        <!-- 메인 푸터 -->
        <div id = "member-detail__main-footer"></div>
</body>

</html>